@model QuickQuoteVM

@{
	ViewData["Title"] = "Báo giá nhanh";
}

<div class="d-flex img-thumbnail justify-content-center">
	<div class="d-flex align-items-center">
		<h3 class="p-3"><a class="text-decoration-none text-black user-select-auto" asp-area="Customer" asp-controller="Home" asp-action="Index">Trang chủ</a></h3>
		<i class="fa-solid fa-arrow-right-long"></i>
		<h3 class="p-3"><a class="text-decoration-none user-select-auto" style="color: #F27456" asp-area="Customer" asp-controller="Quotation" asp-action="Index">Báo giá</a></h3>
		<i class="fa-solid fa-arrow-right-long"></i>
		<h3 class="p-3"><a class="text-decoration-none user-select-auto" style="color: #F27456" asp-area="Customer" asp-controller="Request" asp-action="QuickQuote">Báo giá nhanh</a></h3>
	</div>
</div>

<hr></hr>

<partial name="_QuotationSubNav"></partial>

<div class="container img-thumbnail mt-5 mb-5">

	<form id="quickQuoteForm" class="m-auto" method="post">
		<input asp-for="ConstructDetail.QuotationId" value="@SD.TempId" hidden />
		<div class="mt-3 mb-5 w-75 m-auto">
			<h3 class="text-center"><b>Thông tin công trình</b></h3>
			<hr></hr>
		</div>
		<div class="row mt-2">
			<div class="col-sm">
				<label><b class="text-nowrap">Loại công trình:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.ConstructionId" asp-items="@Model.ConstructionTypes">
					<option disabled selected>--Chọn loại--</option>
				</select>
				<span asp-validation-for="ConstructDetail.ConstructionId" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Mức đầu tư:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.InvestmentId" asp-items="@Model.InvestmentTypes">
					<option disabled selected>--Chọn loại--</option>
				</select>
				<span asp-validation-for="ConstructDetail.InvestmentId" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Chiều rộng(m):</b><span class="text-danger">*</span></label>
				<input class="form-control" asp-for="ConstructDetail.Width"></input>
				<span asp-validation-for="ConstructDetail.Width" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Chiều dài(m):</b><span class="text-danger">*</span></label>
				<input class="form-control" asp-for="ConstructDetail.Length"></input>
				<span asp-validation-for="ConstructDetail.Length" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Mặt tiền:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.Facade" asp-items="@Model.Facades">
				</select>
				<span asp-validation-for="ConstructDetail.Facade" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Hẻm:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.Alley" asp-items="@Model.Alleys">
					<option disabled selected>--Chọn loại--</option>
				</select>
				<span asp-validation-for="ConstructDetail.Alley" class="text-danger"></span>
			</div>
		</div>

		<div class="row">
			<div class="col-sm">
				<label><b class="text-nowrap">Số tầng</b><span class="text-danger">*</span></label>
				<input class="form-control" asp-for="ConstructDetail.Floor"></input>
				<span asp-validation-for="ConstructDetail.Floor" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Số phòng</b><span class="text-danger">*</span></label>
				<input class="form-control" asp-for="ConstructDetail.Room"></input>
				<span asp-validation-for="ConstructDetail.Room" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Diện tích lửng(m2):</b><span class="text-danger">*</span></label>
				<input class="form-control" asp-for="ConstructDetail.Mezzanine"></input>
				<span asp-validation-for="ConstructDetail.Mezzanine" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Tầng thượng(m2):</b><span class="text-danger">*</span></label>
				<input class="form-control" asp-for="ConstructDetail.RooftopFloor"></input>
				<span asp-validation-for="ConstructDetail.RooftopFloor" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Diện tích vườn(m2):</b><span class="text-danger">*</span></label>
				<input class="form-control" asp-for="ConstructDetail.Garden"></input>
				<span asp-validation-for="ConstructDetail.Garden" class="text-danger"></span>
			</div>
			
		</div>

		<div class="row">
			<div class="col-sm">
				<label><b class="text-nowrap">Loại móng:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.FoundationId" asp-items="@Model.FoundationTypes">
					<option disabled selected>--Chọn loại--</option>
				</select>
				<span asp-validation-for="ConstructDetail.FoundationId" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Tầng hầm:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.BasementId" asp-items="@Model.BasementTypes">
					<option disabled selected>--Chọn loại--</option>
				</select>
				<span asp-validation-for="ConstructDetail.BasementId" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Loại mái:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.RooftopId" asp-items="@Model.RooftopTypes">
					<option disabled selected>--Chọn loại--</option>
				</select>
				<span asp-validation-for="ConstructDetail.RooftopId" class="text-danger"></span>
			</div>
			<div class="col-sm">
				<label><b class="text-nowrap">Ban công:</b><span class="text-danger">*</span></label>
				<select type="text" class="form-control" asp-for="ConstructDetail.Balcony">
					<option disabled selected>--Chọn loại--</option>
					<option value="false">Không có ban công</option>
					<option value="true">Có ban công</option>
				</select>
				<span asp-validation-for="ConstructDetail.Balcony" class="text-danger"></span>
			</div>
		</div>

		<div class="row mt-3 mb-2">
			<div class="col-sm">
				<button class="form-control text-white btn btn-main" style="background-color: #F27456" type="submit">Báo giá</button>
			</div>
		</div>

	</form>

	
</div>

@if (Model.ResponseBill != null)
{
	<div class="table-responsive mt-5">
		<table class="table table-bordered table-hover">
			<thead>
				<tr>
					<th colspan="4" class="text-center" style="text-transform: uppercase; text-align:center; font-size:20px;">Đơn giá xây nhà mẫu</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td colspan="4" class="text-right" style="text-align:right">
						<strong>Đơn giá: @Model.ResponseBill.UnitPrice.ToString("N0") VND</strong>
					</td>
				</tr>
				<tr class="label_table">
					<td style="text-transform: uppercase">STT</td>
					<td style="text-transform: uppercase">Loại</td>
					<td style="text-transform: uppercase">Diện tích XD</td>
					<td style="text-transform: uppercase">Thành tiền</td>
				</tr>
				@foreach (var detail in Model.ResponseBill.BillDetails)
				{
					<tr>
						<td>@detail.NumberOfOrder</td>
						<td>@detail.Type</td>
						<td>@detail.ConstructionArea.ToString("0.00") m2</td>
						<td>@detail.Price.ToString("N0") VND</td>
					</tr>
				}
				<tr>
					<td colspan="3" class="text-left"><strong>Tổng diện tích:</strong></td>
					<td class="text-left"><strong>@Model.ResponseBill.TotalArea m2</strong></td>
				</tr>
				<tr>
					<td colspan="3" class="text-left"><strong>Tổng chi phí:</strong></td>
					<td class="text-left"><strong>@Model.ResponseBill.TotalPrice.ToString("N0") VND</strong></td>
				</tr>
			</tbody>
		</table>
	</div>
}

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script>
		document.getElementById("quickQuoteForm").addEventListener("submit", function (event) {
			var constructionType = document.getElementById("ConstructDetail_ConstructionId").value;
			var length = parseFloat(document.getElementById("ConstructDetail_Length").value);
			var width = parseFloat(document.getElementById("ConstructDetail_Width").value);

			var errorMessage = "";

			// Kiểm tra cho nhà cấp 4
			if (constructionType == @SD.ConstructionType_Grade4House && (length < 5 || length > 15 || width < 3 || width > 8)) {
				errorMessage = `"Đối với Nhà cấp 4:
						Chiều dài phải từ 5 - 15m
						Chiều rộng phải từ 3 - 8m."`;
			}
			// Kiểm tra cho biệt thự
			else if (constructionType == @SD.ConstructionType_Mansion && (length < 15 || width < 15)) {
				errorMessage = `"Đối với Biệt thự:
						Chiều dài phải lớn hơn hoặc bằng 15m
						Chiều rộng phải lớn hơn hoặc bằng 15m."`;
			}
			// Kiểm tra cho nhà phố
			else if (constructionType == @SD.ConstructionType_TownHouse && (length < 5 || length > 20 || width < 3 || width > 10)) {
				errorMessage = `"Đối với Biệt thự:
						Chiều dài phải từ 5 - 20m
						Chiều rộng phải từ 3 - 10m"`;
			}

			if (errorMessage != "") {
				Swal.fire({
					icon: "error",
					title: "Oops...",
					text: errorMessage,
				});
				event.preventDefault(); // Ngăn chặn việc gửi yêu cầu đi
			}
		});
	</script>
}